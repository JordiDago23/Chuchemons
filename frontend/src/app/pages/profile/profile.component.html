<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-pokeball">
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <circle cx="50" cy="50" r="48" fill="white" stroke="rgba(255,255,255,0.4)" stroke-width="4"/>
          <path d="M2 50 A48 48 0 0 1 98 50 Z" fill="rgba(255,255,255,0.3)"/>
          <rect x="2" y="46" width="96" height="8" fill="rgba(255,255,255,0.5)"/>
          <circle cx="50" cy="50" r="10" fill="rgba(255,255,255,0.6)"/>
        </svg>
      </div>
      <span class="brand-name">Chuchemons</span>
      <span class="brand-sub">CaptÃºralos a todos</span>
    </div>
    <nav class="sidebar-nav">
      <a class="nav-item" routerLink="/home"><span class="nav-icon">âŒ‚</span> Inicio</a>
      <a class="nav-item" routerLink="/chuchedex"><span class="nav-icon">ğŸ“–</span> Chuchedex</a>
      <a class="nav-item" routerLink="/mochila"><span class="nav-icon">ğŸ’</span> Mochila</a>
      <a class="nav-item" routerLink="/amigos"><span class="nav-icon">ğŸ‘¥</span> Amigos</a>
      <a class="nav-item" routerLink="/batalla"><span class="nav-icon">âš”</span> Batalla</a>
      <a class="nav-item" routerLink="/chat"><span class="nav-icon">ğŸ’¬</span> Chat</a>
      <a class="nav-item active" routerLink="/profile"><span class="nav-icon">ğŸ‘¤</span> Perfil</a>
    </nav>
    <div class="sidebar-footer">
      <ng-container *ngIf="user">
        <div class="footer-avatar">{{ user.nombre?.charAt(0) | uppercase }}</div>
        <div class="footer-info">
          <span class="footer-name">{{ user.player_id }}</span>
          <span class="footer-sub">{{ user.email }}</span>
        </div>
      </ng-container>
      <button class="salir-btn" (click)="logout()"><span>â†ª</span> Salir</button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">

    <!-- PAGE TITLE -->
    <div class="page-title">
      <h1>Mi Perfil</h1>
      <p>Gestiona tu informaciÃ³n personal y estadÃ­sticas</p>
    </div>

    <!-- PROFILE BANNER -->
    <div class="banner" *ngIf="user">
      <div class="banner-left">
        <div class="avatar-wrap">
          <div class="avatar">{{ user.nombre?.charAt(0) | uppercase }}</div>
          <button class="avatar-edit" (click)="editMode = !editMode">âœ</button>
        </div>
        <div class="banner-info">
          <span class="banner-name">{{ user.player_id }}</span>
          <span class="banner-email">{{ user.email }}</span>
          <div class="banner-tags">
            <span class="tag red">â¤ Nivel {{ stats.level }}</span>
            <span class="tag yellow">ğŸ“… Miembro desde el {{ memberSince }}</span>
            <span class="tag gray">ğŸ“¦ {{ stats.captured }} Chuchemons atrapados</span>
          </div>
          <div class="xp-row">
            <span class="xp-label">Experiencia</span>
            <span class="xp-val">{{ stats.xp }}/{{ stats.xpMax }} XP</span>
          </div>
          <div class="xp-track"><div class="xp-fill" [style.width.%]="xpPercent"></div></div>
        </div>
      </div>
      <button class="edit-btn" (click)="editMode = !editMode">âœ Editar Perfil</button>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button [class.active]="activeTab === 'info'"   (click)="activeTab = 'info'">ğŸ‘¤ Informacion</button>
      <button [class.active]="activeTab === 'stats'"  (click)="activeTab = 'stats'">â†— EstadÃ­sticas</button>
      <button [class.active]="activeTab === 'logros'" (click)="activeTab = 'logros'">ğŸ† Logros</button>
    </div>

    <!-- ALERTS -->
    <div *ngIf="success" class="alert-success">{{ success }}</div>
    <div *ngIf="error"   class="alert-error">{{ error }}</div>

    <!-- TAB: INFORMACIÃ“N -->
    <div class="tab-content" *ngIf="activeTab === 'info'">
      <div class="info-card">
        <h2>Informacion personal</h2>
        <p class="section-sub">Actualiza tus datos personales</p>

        <ng-container *ngIf="!editMode">
          <div class="info-field">
            <label>Nombre de usuario</label>
            <div class="info-value">{{ user?.nombre }} {{ user?.apellidos }}</div>
          </div>
          <div class="info-field">
            <label>Correo electronica</label>
            <div class="info-value email-val">âœ‰ {{ user?.email }}</div>
          </div>
          <div class="info-field">
            <label>Biografia</label>
            <div class="info-value">{{ form.bio || 'Sin biografÃ­a' }}</div>
          </div>
          <div class="info-field">
            <label>Data de registro</label>
            <div class="info-value">{{ memberSince }}</div>
          </div>
        </ng-container>

        <ng-container *ngIf="editMode">
          <form (ngSubmit)="onUpdate()">
            <div class="info-field">
              <label>Nombre</label>
              <input type="text" [(ngModel)]="form.nombre" name="nombre" class="input" />
            </div>
            <div class="info-field">
              <label>Apellidos</label>
              <input type="text" [(ngModel)]="form.apellidos" name="apellidos" class="input" />
            </div>
            <div class="info-field">
              <label>Email</label>
              <input type="email" [(ngModel)]="form.email" name="email" class="input" />
            </div>
            <div class="info-field">
              <label>Biografia</label>
              <textarea [(ngModel)]="form.bio" name="bio" class="input textarea" rows="3" placeholder="CuÃ©ntanos algo sobre ti..."></textarea>
            </div>
            <div class="info-field">
              <label>Nueva contraseÃ±a (vacÃ­o = sin cambio)</label>
              <input type="password" [(ngModel)]="form.password" name="password" class="input" />
            </div>
            <div class="info-field">
              <label>Repetir contraseÃ±a</label>
              <input type="password" [(ngModel)]="form.password_confirmation" name="password_confirmation" class="input" />
            </div>
            <div class="form-actions">
              <button type="button" class="btn-cancel" (click)="editMode = false">Cancelar</button>
              <button type="submit" class="btn-save" [disabled]="loading">{{ loading ? 'Guardando...' : 'Guardar cambios' }}</button>
            </div>
          </form>
          <div class="danger-zone">
            <button class="btn-delete" (click)="showConfirm = true">Darme de baja</button>
          </div>
        </ng-container>
      </div>
    </div>

    <!-- TAB: ESTADÃSTICAS -->
    <div class="tab-content" *ngIf="activeTab === 'stats'">
      <div class="stats-row">
        <div class="stats-card">
          <h2>Estadisticas de batalla</h2>
          <div class="stat-item green">
            <span>Victoria</span><span class="stat-num green">{{ stats.wins }}</span>
          </div>
          <div class="stat-item red">
            <span>Derrota</span><span class="stat-num red">{{ stats.losses }}</span>
          </div>
          <div class="stat-item blue">
            <span>tasa de victoria</span><span class="stat-num blue">{{ winRatio }}</span>
          </div>
          <div class="stat-item orange">
            <span>Racha actual</span><span class="stat-num orange">{{ stats.streak }}</span>
          </div>
        </div>
        <div class="stats-card">
          <h2>Estadisticas de batalla</h2>
          <div class="capture-header">
            <span>Xuxemons Capturados</span>
            <span class="capture-count">{{ stats.captured }}/{{ stats.captured + 1 }}</span>
          </div>
          <div class="capture-bar"><div class="capture-fill" [style.width.%]="xpPercent"></div></div>
          <p class="capture-pct">{{ xpPercent }}% completado</p>
          <div class="type-stat" *ngFor="let t of typeStats" [style.background]="t.color + '18'">
            <span>{{ t.type }}</span>
            <span class="type-num" [style.color]="t.color">{{ t.count }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: LOGROS -->
    <div class="tab-content" *ngIf="activeTab === 'logros'">
      <div class="logros-grid">
        <div class="logro-card" *ngFor="let l of logros" [class.locked]="l.status === 'locked'">
          <span class="logro-icon" [class.locked]="l.status === 'locked'">{{ l.icon }}</span>
          <span class="logro-title" [class.locked]="l.status === 'locked'">{{ l.title }}</span>
          <span class="logro-desc">{{ l.desc }}</span>
          <span *ngIf="l.status === 'done'"     class="badge done">Completado</span>
          <span *ngIf="l.status === 'progress'" class="badge progress">En progreso: {{ l.progress }}</span>
          <span *ngIf="l.status === 'locked'"   class="badge locked">Bloqueado</span>
        </div>
      </div>
    </div>

  </main>

  <!-- CONFIRM DIALOG -->
  <div class="overlay" *ngIf="showConfirm">
    <div class="dialog">
      <h3>Â¿EstÃ¡s seguro?</h3>
      <p>Esta acciÃ³n es irreversible. Tu cuenta serÃ¡ eliminada permanentemente.</p>
      <div class="dialog-actions">
        <button class="btn-cancel" (click)="showConfirm = false">Cancelar</button>
        <button class="btn-delete" (click)="onDelete()">SÃ­, darme de baja</button>
      </div>
    </div>
  </div>

</div>
